<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Demo CDP Imagino</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body {
      padding-top: 70px;
    }
    .navbar-brand img {
      height: 40px;
    }
    .banner {
      background: url('campaign.png') no-repeat center center;
      background-size: cover;
      height: 300px;
      position: relative;
      color: white;
      text-align: center;
    }
    .banner h1 {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.5);
      padding: 10px 20px;
    }
    .section {
      padding: 30px 0;
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
    <a class="navbar-brand" href="index.html">
      <img src="logo.png" alt="Logo">
      Demo CDP Imagino
    </a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="panier.html">Panier</a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Banner -->
  <header class="banner">
    <h1>Bienvenue sur le site de démonstration CDP Imagino</h1>
  </header>

  <!-- Section Produits -->
  <div class="container section">
    <h2 class="text-center">Nos Produits</h2>
    <div class="row">
      <!-- Produit CDP -->
      <div class="col-md-4 d-flex align-items-stretch">
        <div class="card">
          <img src="cdp.png" class="card-img-top" alt="CDP">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">CDP</h5>
            <p class="card-text">La solution CDP vous permet de centraliser les données clients pour une gestion optimisée de vos campagnes marketing.</p>
            <p class="card-text"><strong>Prix : 49.99 €</strong></p>
            <button class="btn btn-primary mt-auto" onclick="addToCart('CDP', 49.99, 'cdp.png')">Ajouter au panier</button>
          </div>
        </div>
      </div>
      <!-- Produit Campaign -->
      <div class="col-md-4 d-flex align-items-stretch">
        <div class="card">
          <img src="campaign.png" class="card-img-top" alt="Campaign">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Campaign</h5>
            <p class="card-text">Campaign est notre outil innovant pour créer, gérer et analyser vos campagnes publicitaires.</p>
            <p class="card-text"><strong>Prix : 29.99 €</strong></p>
            <button class="btn btn-primary mt-auto" onclick="addToCart('Campaign', 29.99, 'campaign.png')">Ajouter au panier</button>
          </div>
        </div>
      </div>
      <!-- Produit Petit Déjeuner -->
      <div class="col-md-4 d-flex align-items-stretch">
        <div class="card">
          <img src="cachan.png" class="card-img-top" alt="Petit Déjeuner">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Petit Déjeuner</h5>
            <p class="card-text">Savourez un délicieux petit déjeuner pour bien commencer la journée avec notre offre gourmande.</p>
            <p class="card-text"><strong>Prix : 9.99 €</strong></p>
            <button class="btn btn-primary mt-auto" onclick="addToCart('Petit Déjeuner', 9.99, 'cachan.png')">Ajouter au panier</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Section Newsletter / Inscription dans une carte centrée -->
  <div class="container section">
    <div class="row justify-content-center">
      <div class="col-md-6">
        <div class="card">
          <div class="card-header text-center">
            Inscription à la Newsletter
          </div>
          <div class="card-body">
            <form id="newsletterForm">
              <div class="form-row">
                <div class="form-group col-md-6">
                  <label for="firstName">Prénom</label>
                  <input type="text" class="form-control" id="firstName" placeholder="Votre prénom" required>
                </div>
                <div class="form-group col-md-6">
                  <label for="lastName">Nom</label>
                  <input type="text" class="form-control" id="lastName" placeholder="Votre nom" required>
                </div>
              </div>
              <div class="form-group">
                <label for="email">Adresse Email</label>
                <input type="email" class="form-control" id="email" placeholder="Votre email" required>
              </div>
              <div class="form-group">
                <label for="telephone">Téléphone</label>
                <input type="text" class="form-control" id="telephone" placeholder="Votre téléphone" required>
              </div>
              <div class="form-group">
                <label for="dateOfBirth">Date de Naissance</label>
                <input type="date" class="form-control" id="dateOfBirth" required>
              </div>
              <button type="submit" class="btn btn-primary btn-block">S'inscrire</button>
            </form>
            <div id="responseMessage" class="mt-3"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JS Scripts -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Fonction d'ajout d'un produit au panier
    function addToCart(name, price, image) {
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      const existingIndex = cart.findIndex(item => item.name === name);
      if (existingIndex >= 0) {
        cart[existingIndex].quantity += 1;
      } else {
        cart.push({ name, price, image, quantity: 1 });
      }
      localStorage.setItem('cart', JSON.stringify(cart));
      alert(name + " a été ajouté au panier !");
    }

    // Gestion du formulaire newsletter avec appel API vers Imagino
    document.getElementById('newsletterForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const firstName = document.getElementById('firstName').value;
      const lastName = document.getElementById('lastName').value;
      const email = document.getElementById('email').value;
      const telephone = document.getElementById('telephone').value;
      const dateOfBirth = document.getElementById('dateOfBirth').value;
      
      const payload = {
        Entreprise: 1,
        WEB_ID: 1,
        addressLine: "",
        dateOfBirth: dateOfBirth,
        email: email,
        firstName: firstName,
        gender: "non spécifié",
        lastModifiedDate: new Date().toISOString(),
        lastName: lastName,
        optInEmail: true,
        optInPush: false,
        optInSMS: false,
        telephone: telephone,
        ucdId: ""
      };

      const apiEndpoint = 'https://francois-sandbox.saas.imagino.com/ucdapi/New_customer/2/RCU';
      const apiKey = '2a79b8c4-b270-4a61-8b64-437ccea75586';

      try {
        const response = await fetch(apiEndpoint, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-API-KEY': apiKey
          },
          body: JSON.stringify(payload)
        });
        
        const data = await response.json();
        if (response.ok) {
          document.getElementById('responseMessage').innerHTML = '<div class="alert alert-success">Inscription réussie ! ID généré : ' + (data.ucdId || 'N/A') + '</div>';
        } else {
          document.getElementById('responseMessage').innerHTML = '<div class="alert alert-danger">Erreur : ' + (data.error || 'Une erreur est survenue.') + '</div>';
        }
      } catch (error) {
        console.error('Erreur :', error);
        document.getElementById('responseMessage').innerHTML = '<div class="alert alert-danger">Erreur de connexion : ' + error.message + '</div>';
      }
    });
  </script>
</body>
</html>

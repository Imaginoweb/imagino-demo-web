<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Demo CDP Imagino</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body {
      padding-top: 70px;
    }
    .navbar-brand img {
      height: 40px;
    }
    .banner {
      background: url('campaign.png') no-repeat center center;
      background-size: cover;
      height: 300px;
      position: relative;
      color: white;
      text-align: center;
    }
    .banner h1 {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.5);
      padding: 10px 20px;
    }
    .section {
      padding: 30px 0;
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
    <a class="navbar-brand" href="index.html">
      <img src="logo.png" alt="Logo">
      Demo CDP Imagino
    </a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="panier.html">Panier</a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Banner -->
  <header class="banner">
    <h1>Bienvenue sur le site de démonstration CDP Imagino</h1>
  </header>

  <!-- Section Clients & Solutions -->
  <div class="container section">
    <h2>Nos Clients et Solutions</h2>
    <div class="row">
      <div class="col-md-4">
        <img src="cdp.png" class="img-fluid" alt="CDP">
      </div>
      <div class="col-md-4">
        <img src="cachan.png" class="img-fluid" alt="Cachan">
      </div>
      <div class="col-md-4">
        <img src="campaign.png" class="img-fluid" alt="Campaign">
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-md-4">
        <img src="client1.png" class="img-fluid" alt="Client 1">
      </div>
      <div class="col-md-4">
        <img src="client2.png" class="img-fluid" alt="Client 2">
      </div>
      <div class="col-md-4">
        <img src="client3.png" class="img-fluid" alt="Client 3">
      </div>
    </div>
  </div>

  <!-- Section Produits -->
  <div class="container section">
    <h2>Nos Produits</h2>
    <div class="row">
      <!-- Produit CDP -->
      <div class="col-md-4">
        <div class="card">
          <img src="cdp.png" class="card-img-top" alt="CDP">
          <div class="card-body">
            <h5 class="card-title">CDP</h5>
            <p class="card-text">Prix: 49.99 €</p>
            <button class="btn btn-primary" onclick="addToCart('CDP', 49.99, 'cdp.png')">Ajouter au panier</button>
          </div>
        </div>
      </div>
      <!-- Produit Campaign -->
      <div class="col-md-4">
        <div class="card">
          <img src="campaign.png" class="card-img-top" alt="Campaign">
          <div class="card-body">
            <h5 class="card-title">Campaign</h5>
            <p class="card-text">Prix: 29.99 €</p>
            <button class="btn btn-primary" onclick="addToCart('Campaign', 29.99, 'campaign.png')">Ajouter au panier</button>
          </div>
        </div>
      </div>
      <!-- Produit Petit Déjeuner -->
      <div class="col-md-4">
        <div class="card">
          <img src="https://via.placeholder.com/300x200?text=Petit+Déjeuner" class="card-img-top" alt="Petit Déjeuner">
          <div class="card-body">
            <h5 class="card-title">Petit Déjeuner</h5>
            <p class="card-text">Prix: 9.99 €</p>
            <button class="btn btn-primary" onclick="addToCart('Petit Déjeuner', 9.99, 'https://via.placeholder.com/300x200?text=Petit+Déjeuner')">Ajouter au panier</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Section Newsletter / Inscription -->
  <div class="container section">
    <h2>Inscription à la Newsletter</h2>
    <form id="newsletterForm">
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="firstName">Prénom</label>
          <input type="text" class="form-control" id="firstName" placeholder="Votre prénom" required>
        </div>
        <div class="form-group col-md-6">
          <label for="lastName">Nom</label>
          <input type="text" class="form-control" id="lastName" placeholder="Votre nom" required>
        </div>
      </div>
      <div class="form-group">
        <label for="email">Adresse Email</label>
        <input type="email" class="form-control" id="email" placeholder="Votre email" required>
      </div>
      <div class="form-group">
        <label for="telephone">Téléphone</label>
        <input type="text" class="form-control" id="telephone" placeholder="Votre téléphone" required>
      </div>
      <div class="form-group">
        <label for="dateOfBirth">Date de Naissance</label>
        <input type="date" class="form-control" id="dateOfBirth" required>
      </div>
      <button type="submit" class="btn btn-primary">S'inscrire</button>
    </form>
    <div id="responseMessage" class="mt-3"></div>
  </div>

  <!-- Section Graphiques Démonstration -->
  <div class="container section">
    <h2>Graphiques Démonstration</h2>
    <canvas id="demoChart" width="400" height="200"></canvas>
  </div>

  <!-- JS Scripts -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Initialisation du graphique avec Chart.js
    const ctx = document.getElementById('demoChart').getContext('2d');
    const demoChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin'],
        datasets: [{
          label: 'Exemple de ventes',
          data: [12, 19, 3, 5, 2, 3],
          backgroundColor: 'rgba(54, 162, 235, 0.2)',
          borderColor: 'rgba(54, 162, 235, 1)',
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          yAxes: [{
            ticks: { beginAtZero: true }
          }]
        }
      }
    });

    // Fonction d'ajout d'un produit au panier
    function addToCart(name, price, image) {
      let cart = JSON.parse(localStorage.getItem('cart')) || [];
      const existingIndex = cart.findIndex(item => item.name === name);
      if (existingIndex >= 0) {
        cart[existingIndex].quantity += 1;
      } else {
        cart.push({ name, price, image, quantity: 1 });
      }
      localStorage.setItem('cart', JSON.stringify(cart));
      alert(name + " a été ajouté au panier !");
    }

    // Gestion du formulaire newsletter avec appel API vers Imagino
    document.getElementById('newsletterForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const firstName = document.getElementById('firstName').value;
      const lastName = document.getElementById('lastName').value;
      const email = document.getElementById('email').value;
      const telephone = document.getElementById('telephone').value;
      const dateOfBirth = document.getElementById('dateOfBirth').value;
      
      const payload = {
        Entreprise: 1,
        WEB_ID: 1,
        addressLine: "",
        dateOfBirth: dateOfBirth,
        email: email,
        firstName: firstName,
        gender: "non spécifié",
        lastModifiedDate: new Date().toISOString(),
        lastName: lastName,
        optInEmail: true,
        optInPush: false,
        optInSMS: false,
        telephone: telephone,
        ucdId: ""
      };

      const apiEndpoint = 'https://francois-sandbox.saas.imagino.com/ucdapi/New_customer/2/RCU';
      const apiKey = '2a79b8c4-b270-4a61-8b64-437ccea75586';

      try {
        const response = await fetch(apiEndpoint, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-API-KEY': apiKey
          },
          body: JSON.stringify(payload)
        });
        
        const data = await response.json();
        if (response.ok) {
          document.getElementById('responseMessage').innerHTML = '<div class="alert alert-success">Inscription réussie ! ID généré: ' + (data.ucdId || 'N/A') + '</div>';
        } else {
          document.getElementById('responseMessage').innerHTML = '<div class="alert alert-danger">Erreur: ' + (data.error || 'Une erreur est survenue.') + '</div>';
        }
      } catch (error) {
        console.error('Erreur:', error);
        document.getElementById('responseMessage').innerHTML = '<div class="alert alert-danger">Erreur de connexion: ' + error.message + '</div>';
      }
    });
  </script>
</body>
</html>

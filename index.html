<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Recherche et Mise √† jour profil Imagino üîç</title>
    <style>
        body { font-family: Arial, sans-serif; }
        button { padding: 8px 12px; cursor: pointer; }
        input { padding: 6px; margin-right: 8px; }
        .field { margin-bottom: 10px; }
        #output { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Recherche et Mise √† jour profil Imagino üîç</h1>

    <div>
        <input type="text" id="email" placeholder="Entrer l'Email">
        <button onclick="rechercherProfil()">Rechercher</button>
    </div>

    <h3>Mettre √† jour les informations</h3>
    <div class="field"><input type="text" id="firstName" placeholder="Pr√©nom"></div>
    <div class="field"><input type="text" id="lastName" placeholder="Nom"></div>
    <div class="field"><input type="text" id="telephone" placeholder="T√©l√©phone"></div>

    <div class="field">
        <label><input type="checkbox" id="optInEmail"> Opt-in Email</label>
        <label><input type="checkbox" id="optInPush"> Opt-in Push</label>
        <label><input type="checkbox" id="optInSMS"> Opt-in SMS</label>
    </div>

    <button onclick="mettreAJourProfil()">Mettre √† jour</button>

    <div id="output"></div>

    <script>
        const apiKey = '2a79b8c4-b270-4a61-8b64-437ccea75586';

        function rechercherProfil() {
            const email = document.getElementById('email').value;

            fetch(`https://francois-sandbox.saas.imagino.com/ucdapi/New_customer/2/RCU?exact_email=${encodeURIComponent(email)}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-KEY': apiKey
                }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('output').innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
            })
            .catch(error => {
                document.getElementById('output').innerHTML = `<pre>Erreur: ${error}</pre>`;
            });
        }

        function mettreAJourProfil() {
            const email = document.getElementById('email').value;
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const telephone = document.getElementById('telephone').value;
            const optInEmail = document.getElementById('optInEmail').checked;
            const optInPush = document.getElementById('optInPush').checked;
            const optInSMS = document.getElementById('optInSMS').checked;

            fetch(`https://francois-sandbox.saas.imagino.com/ucdapi/New_customer/2/RCU`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-KEY': apiKey
                },
                body: JSON.stringify({
                    email,
                    firstName,
                    lastName,
                    telephone,
                    optInEmail,
                    optInPush,
                    optInSMS
                })
            })
            .then(response => response.json())
            .then(data => {
                const message = data.ucdId ? 'Votre compte a √©t√© mis √† jour' : 'Compte cr√©√©';
                document.getElementById('output').innerHTML = `<pre>${message}\n` + JSON.stringify(data, null, 2) + '</pre>';
            })
            .catch(error => {
                document.getElementById('output').innerHTML = `<pre>Erreur: ${error}</pre>`;
            });
        }
    </script>

</body>
</html>
